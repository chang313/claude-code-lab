# Implementation Plan: Naver Import Category Auto-Enrichment

**Branch**: `026-naver-category-enrichment` | **Date**: 2026-02-23 | **Spec**: [spec.md](spec.md)
**Input**: Feature specification from `/specs/026-naver-category-enrichment/spec.md`

## Summary

Improve the Naver-to-Kakao enrichment pipeline to maximize category assignment for imported restaurants. Currently ~50-60% of imports remain as "기타" due to strict 100m radius and naive substring name matching. This plan: (1) expands search radius to 300m, (2) adds suffix-aware name normalization, (3) adds coordinate-based category fallback via Kakao Category Search API, (4) adds a one-time retroactive re-enrichment API for existing "기타" restaurants, and (5) shows categorization stats in import history UI.

## Technical Context

**Language/Version**: TypeScript 5.x (strict mode)
**Primary Dependencies**: Next.js 16 (App Router), React 19, Supabase (@supabase/ssr), Kakao Local REST API
**Storage**: Supabase Postgres with RLS
**Testing**: Vitest + React Testing Library (unit tests only, no E2E)
**Target Platform**: Mobile-first web application (Vercel deployment)
**Project Type**: Web application (Next.js App Router — unified src/ structure)
**Performance Goals**: Enrichment ≤150ms per restaurant (current: ~100ms with throttle). SC-002 allows up to 50% overhead.
**Constraints**: Kakao API rate limits (soft, mitigated by 100ms throttle), fire-and-forget enrichment (no job queue)
**Scale/Scope**: Up to 300 restaurants per import batch, retroactive pass covers all users' uncategorized restaurants

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

| Principle | Status | Notes |
|-----------|--------|-------|
| I. Code Quality | PASS | Modifying existing functions with clear single responsibilities; no new abstractions needed |
| II. Testing Standards | PASS | Existing test patterns in `enrichment.test.ts` — extend with new matching scenarios and fallback tests |
| III. User Experience Consistency | PASS | Minor UI change (stats text in ImportHistory) — follows existing pattern |
| IV. Performance Requirements | PASS | Enrichment is background/async — not user-blocking. Throttle preserved. |
| V. Simplicity | PASS | Extends existing enrichment functions — no new abstractions, no new dependencies |

No violations. No complexity tracking needed.

## Project Structure

### Documentation (this feature)

```text
specs/026-naver-category-enrichment/
├── plan.md              # This file
├── research.md          # Phase 0: Kakao API research
├── data-model.md        # Phase 1: Schema changes (import_batches stats)
├── quickstart.md        # Phase 1: Dev setup & testing
├── contracts/           # Phase 1: API contract changes
│   └── enrich-api.md    # Re-enrich + retroactive endpoints
└── tasks.md             # Phase 2: Generated by /speckit.tasks
```

### Source Code (repository root)

```text
src/
├── lib/
│   ├── enrichment.ts        # MODIFY: expanded matching, category fallback
│   └── kakao.ts             # MODIFY: add searchByCategory() function
├── app/api/import/
│   ├── enrich/route.ts      # MODIFY: support category-only filter
│   └── re-enrich/route.ts   # NEW: retroactive re-enrichment endpoint
├── components/
│   └── ImportHistory.tsx     # MODIFY: show categorization stats
└── db/
    └── import-hooks.ts      # MODIFY: add useRetroactiveEnrich hook

tests/unit/
├── enrichment.test.ts       # MODIFY: add relaxed matching + fallback tests
└── category-fallback.test.ts # NEW: coordinate-based fallback tests
```

**Structure Decision**: Existing Next.js App Router structure. No new directories needed — all changes are modifications to existing files plus one new API route and one new test file.
