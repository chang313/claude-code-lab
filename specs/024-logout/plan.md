# Implementation Plan: Logout from My Info Tab

**Branch**: `024-logout` | **Date**: 2026-02-22 | **Spec**: [spec.md](spec.md)
**Input**: Feature specification from `/specs/024-logout/spec.md`

## Summary

Add a logout button to the ProfileHeader component (visible only on own profile). Tapping it shows a confirmation dialog; on confirm, calls Supabase `signOut()`, which triggers the existing `AuthCacheGuard` to `invalidateAll()`, then redirects to `/login`.

## Technical Context

**Language/Version**: TypeScript 5.x, React 19, Next.js 16 App Router
**Primary Dependencies**: @supabase/ssr (auth), Tailwind CSS 4 (styling)
**Storage**: N/A (no schema changes — logout is session destruction only)
**Testing**: Vitest + React Testing Library
**Target Platform**: Mobile-first web (Chrome, Safari)
**Project Type**: Web application (Next.js App Router)
**Performance Goals**: Logout completes in <3s (SC-001)
**Constraints**: Must clear all cached data on sign-out (existing AuthCacheGuard handles this)
**Scale/Scope**: Single button + confirmation dialog, 2 files modified, 1 test file

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

| Principle | Status | Notes |
|-----------|--------|-------|
| I. Code Quality | PASS | Single responsibility: logout logic in ProfileHeader, cache clearing in existing AuthCacheGuard |
| II. Testing Standards | PASS | Unit test will cover: button renders on own profile, hidden on other profiles, signOut called on confirm, redirect on success, error toast on failure |
| III. UX Consistency | PASS | Uses existing Toast component for error feedback, loading state within 200ms |
| IV. Performance | PASS | No new API calls, no bundle size increase (uses existing Supabase client) |
| V. Simplicity | PASS | Minimal change: add button + confirm dialog + signOut call. No new dependencies, no new abstractions |

## Project Structure

### Documentation (this feature)

```text
specs/024-logout/
├── plan.md              # This file
├── spec.md              # Feature specification
├── checklists/
│   └── requirements.md  # Quality checklist
└── tasks.md             # Task list (generated by /speckit.tasks)
```

### Source Code (repository root)

```text
src/
├── components/
│   ├── ProfileHeader.tsx    # MODIFY: add logout button + confirmation + signOut call
│   └── Toast.tsx            # REUSE: error feedback on logout failure
│   └── AuthCacheGuard.tsx   # EXISTING: auto-clears cache on SIGNED_OUT event
├── lib/supabase/
│   ├── client.ts            # REUSE: createClient() for signOut
│   └── invalidate.ts        # EXISTING: invalidateAll() triggered by AuthCacheGuard

tests/unit/
└── logout.test.tsx          # NEW: unit tests for logout behavior
```

**Structure Decision**: Existing Next.js App Router structure. Only `ProfileHeader.tsx` modified; one new test file added.

## Design Details

### Approach

1. **ProfileHeader.tsx**: When `isOwnProfile` is true, render a logout button below the follow stats. On tap, show `window.confirm("로그아웃 하시겠습니까?")` — the simplest confirmation UX that satisfies FR-002 without adding a custom modal component.

2. **Sign-out flow**: Call `supabase.auth.signOut()`. On success, `router.push("/login")`. The existing `AuthCacheGuard` listens for `SIGNED_OUT` and calls `invalidateAll()` automatically — no additional cache-clearing code needed.

3. **Error handling**: If `signOut()` returns an error, show the existing `Toast` component with type `"error"`. User remains logged in.

4. **Loading state**: Disable button and show spinner during the signOut call to prevent double-taps.

### Why No Research/Data-Model/Contracts Needed

- **No new data model**: Logout destroys a session; no tables or columns change.
- **No new API contracts**: `signOut()` is a Supabase SDK call, not a custom endpoint.
- **No research**: The tech stack (Supabase signOut, AuthCacheGuard, router.push) is well-understood from prior features.
